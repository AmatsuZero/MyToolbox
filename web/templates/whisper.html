<!-- 占位：Whisper 页面模板将在任务 9 中实现 -->
{% extends "base.html" %}

{% block title %}Whisper 字幕提取 - MyToolbox{% endblock %}

{% block content %}
<div class="row">
    <!-- 左侧：上传和参数配置 -->
    <div class="col-lg-5 mb-4">
        <!-- 文件上传区域 -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-upload me-2"></i>上传文件
                </h5>
            </div>
            <div class="card-body">
                <div class="upload-zone" id="uploadZone">
                    <input type="file" id="fileInput" accept=".mp3,.wav,.flac,.aac,.ogg,.m4a,.wma,.mp4,.mkv,.avi,.mov,.wmv,.flv,.webm,.m4v" multiple>
                    <i class="bi bi-cloud-arrow-up upload-icon"></i>
                    <h5 class="mt-3">拖拽文件到此处</h5>
                    <p class="text-muted mb-0">或点击选择文件</p>
                    <p class="text-muted small mt-2">
                        支持 MP4、MKV、MP3、WAV 等音视频格式
                    </p>
                </div>

                <!-- 已上传文件列表 -->
                <div id="fileList" class="file-list mt-3" style="display: none;">
                    <h6 class="mb-3">已选择的文件</h6>
                    <div id="fileListContent"></div>
                </div>
            </div>
        </div>

        <!-- 参数配置面板 -->
        <div class="card config-panel">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-gear me-2"></i>参数配置
                </h5>
            </div>
            <div class="card-body">
                <!-- 模型选择 -->
                <div class="mb-3">
                    <label for="modelSelect" class="form-label">Whisper 模型</label>
                    <select class="form-select" id="modelSelect">
                        <option value="tiny">Tiny - 最快速度，较低精度</option>
                        <option value="base" selected>Base - 快速，中等精度</option>
                        <option value="small">Small - 中等速度，较好精度</option>
                        <option value="medium">Medium - 较慢，很好精度</option>
                        <option value="large">Large - 最慢，最佳精度</option>
                    </select>
                    <div class="form-text">更大的模型精度更高，但处理速度更慢</div>
                </div>

                <!-- 语言选择 -->
                <div class="mb-3">
                    <label for="languageSelect" class="form-label">语言</label>
                    <select class="form-select" id="languageSelect">
                        <option value="auto" selected>自动检测</option>
                        <option value="zh">中文</option>
                        <option value="en">英语</option>
                        <option value="ja">日语</option>
                        <option value="ko">韩语</option>
                        <option value="fr">法语</option>
                        <option value="de">德语</option>
                        <option value="es">西班牙语</option>
                        <option value="ru">俄语</option>
                    </select>
                    <div class="form-text">手动指定语言可提高识别准确度</div>
                </div>

                <!-- 输出格式 -->
                <div class="mb-3">
                    <label for="formatSelect" class="form-label">输出格式</label>
                    <select class="form-select" id="formatSelect">
                        <option value="all" selected>全部格式</option>
                        <option value="srt">SRT - 通用字幕格式</option>
                        <option value="vtt">VTT - Web 字幕格式</option>
                        <option value="txt">TXT - 纯文本</option>
                        <option value="json">JSON - 结构化数据</option>
                        <option value="csv">CSV - 表格格式</option>
                    </select>
                </div>

                <!-- 开始处理按钮 -->
                <button type="button" class="btn btn-primary w-100" id="startBtn" disabled>
                    <i class="bi bi-play-fill me-2"></i>开始处理
                </button>
            </div>
        </div>
    </div>

    <!-- 右侧：进度和结果 -->
    <div class="col-lg-7">
        <!-- 进度区域 -->
        <div class="card mb-4" id="progressCard" style="display: none;">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-hourglass-split me-2"></i>处理进度
                </h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                    <span id="progressStage">准备中...</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress mb-3">
                    <div class="progress-bar progress-bar-striped progress-bar-animated"
                         id="progressBar"
                         role="progressbar"
                         style="width: 0%">
                    </div>
                </div>
                <p class="text-muted mb-0" id="progressMessage">正在准备处理任务...</p>
            </div>
        </div>

        <!-- 结果区域 -->
        <div class="card result-section" id="resultCard" style="display: none;">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-check-circle text-success me-2"></i>处理结果
                    </h5>
                    <span class="status-indicator completed">
                        <i class="bi bi-check-circle-fill"></i> 完成
                    </span>
                </div>
            </div>
            <div class="card-body">
                <!-- 结果摘要 -->
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <div class="border rounded p-3">
                            <div class="text-muted small">检测语言</div>
                            <div class="fw-bold" id="resultLanguage">-</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="border rounded p-3">
                            <div class="text-muted small">识别置信度</div>
                            <div class="fw-bold" id="resultConfidence">-</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="border rounded p-3">
                            <div class="text-muted small">音频时长</div>
                            <div class="fw-bold" id="resultDuration">-</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="border rounded p-3">
                            <div class="text-muted small">字幕片段数</div>
                            <div class="fw-bold" id="resultSegments">-</div>
                        </div>
                    </div>
                </div>

                <!-- 下载链接 -->
                <h6 class="mb-3">下载字幕文件</h6>
                <div class="download-list" id="downloadList">
                    <!-- 动态生成下载链接 -->
                </div>
            </div>
        </div>

        <!-- 任务列表 -->
        <div class="card" id="taskListCard">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-list-task me-2"></i>任务历史
                </h5>
                <button class="btn btn-sm btn-outline-secondary" id="refreshTasksBtn">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>
            </div>
            <div class="card-body">
                <div id="taskListContent">
                    <p class="text-muted text-center mb-0">暂无任务</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/whisper.js') }}"></script>
{% endblock %}
