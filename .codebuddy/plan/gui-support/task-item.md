# 实施计划：GUI Web 界面支持

本文档基于 `requirements.md` 需求文档，列出实现 GUI Web 界面支持功能的编码任务清单。

---

- [ ] 1. 搭建 Web 模块基础架构
   - 创建 `web/` 目录及其子目录结构（`routes/`、`static/`、`templates/`）
   - 创建 `web/__init__.py` 和 `web/app.py`，实现 Flask 应用工厂模式
   - 配置 CORS、静态文件路由和模板引擎
   - 在 `pyproject.toml` 中添加 Flask 等可选依赖
   - _需求：2.1、2.2、2.6_

- [ ] 2. 扩展命令行参数支持
   - 在 `core/cli/cli_interface.py` 中添加 `--gui`、`--port`、`--host`、`--no-browser` 参数
   - 实现参数解析逻辑，根据参数组合确定初始页面路由
   - 在 `main.py` 中添加 GUI 模式启动逻辑，调用 Flask 应用启动
   - 实现自动打开浏览器功能（可通过 `--no-browser` 禁用）
   - _需求：1.1、1.2、1.3、1.4、1.5、1.6、10.1、10.2、10.3、10.4、10.5、10.6_

- [ ] 3. 实现后端 API 基础设施
   - 创建 `web/routes/__init__.py`，定义 Blueprint 注册机制
   - 实现统一的 JSON 响应格式封装函数（`success_response`、`error_response`）
   - 实现全局异常处理器，返回结构化错误响应
   - 创建任务管理器类，用于管理异步任务的状态跟踪
   - _需求：2.3、2.4、2.5、9.6、9.7_

- [ ] 4. 实现文件上传 API
   - 创建 `web/routes/upload.py`，实现 `POST /api/upload` 接口
   - 实现文件格式验证（支持的音视频格式检查）
   - 实现文件大小限制检查（默认 2GB）
   - 实现上传进度追踪机制
   - 实现临时文件存储和管理
   - _需求：6.2、6.3、6.4、6.7、9.1_

- [ ] 5. 实现 Whisper API 路由
   - 创建 `web/routes/whisper.py`，实现 `POST /api/whisper/start` 接口
   - 集成现有的 `SpeechToTextSystem` 类处理语音识别任务
   - 实现 `GET /api/task/<task_id>/status` 接口，返回任务进度和状态
   - 实现 `GET /api/download/<file_id>` 接口，提供字幕文件下载
   - 实现任务进度回调机制，更新任务状态
   - _需求：4.6、4.7、4.8、4.9、9.2、9.3、9.4_

- [ ] 6. 实现训练 API 路由
   - 创建 `web/routes/train.py`，实现 `POST /api/train/start` 接口
   - 集成现有的 `TrainController` 类处理训练任务
   - 实现训练进度和损失值的实时状态更新
   - 实现训练模型文件下载接口
   - _需求：5.4、5.5、5.6、5.7、9.5_

- [ ] 7. 创建前端基础模板和样式
   - 创建 `web/templates/base.html` 基础模板，引入 Bootstrap/Tailwind CSS
   - 创建 `web/static/css/main.css`，定义全局样式和响应式布局
   - 创建 `web/static/js/common.js`，实现通用 JavaScript 工具函数（Toast 通知、API 调用封装）
   - 实现暗色模式自动切换支持（CSS 媒体查询）
   - _需求：8.1、8.2、8.3、8.4、8.5_

- [ ] 8. 实现主页面（Homepage）
   - 创建 `web/routes/main.py`，定义主页面路由（`/`）
   - 创建 `web/templates/index.html`，实现功能入口卡片布局
   - 实现「字幕提取」和「语音训练」两个功能卡片的导航跳转
   - 添加应用标题、功能说明和使用引导提示
   - _需求：3.1、3.2、3.3、3.4、3.5_

- [ ] 9. 实现 Whisper 字幕提取页面
   - 创建 `web/templates/whisper.html`，实现完整的字幕提取界面
   - 实现文件拖拽上传区域组件（支持高亮、预览、批量添加）
   - 实现参数配置面板（模型大小、语言、输出格式选择）
   - 创建 `web/static/js/whisper.js`，实现文件上传、任务启动和进度轮询逻辑
   - 实现实时进度条显示（上传进度、处理阶段、总体进度）
   - 实现结果展示区域和字幕文件下载功能
   - _需求：4.1、4.2、4.3、4.4、4.5、4.10、6.1、6.5、6.6、7.1、7.2、7.3、7.4、7.5_

- [ ] 10. 实现语音训练页面
   - 创建 `web/templates/train.html`，实现完整的语音训练界面
   - 实现训练数据上传区域（支持音频和字幕文件配对上传）
   - 实现训练参数配置面板（说话人名称、epochs、批处理大小、采样率）
   - 创建 `web/static/js/train.js`，实现训练任务启动和进度监控逻辑
   - 实现训练进度、轮次和损失值的实时图表展示
   - 实现训练结果摘要和模型下载功能
   - _需求：5.1、5.2、5.3、7.1、7.2、7.3、7.6_

---

## 任务依赖关系

```
1 → 2 → 3 → 4 → 5, 6 (并行)
        ↓
7 → 8 → 9, 10 (并行)
```

## 注意事项

1. 任务 1-3 为基础设施搭建，需按顺序完成
2. 任务 4 文件上传是 5、6 的前置依赖
3. 任务 5、6 可并行开发（Whisper API 和 训练 API）
4. 任务 7 前端基础需在页面开发前完成
5. 任务 9、10 可并行开发（两个功能页面）
